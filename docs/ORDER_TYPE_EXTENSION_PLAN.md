# 제작 유형 확장 – 구현 가능 여부 및 방안

현재는 **책자(매체 기준)** 의뢰만 지원합니다. 여기에 **낱장, 스티커, 배너, 기타** 등 유형을 추가하고, 유형별로 다른 입력 항목을 쓰도록 확장하는 방안을 정리했습니다.

---

## 1. 구현 가능 여부

**가능합니다.**

- 의뢰서 작성 시 **제작 유형**을 먼저 선택하고, 유형에 따라 **다른 입력 폼**을 보여 주는 방식으로 확장할 수 있습니다.
- 유형은 **나중에 추가**할 수 있고, **유형별 데이터를 한 컬럼(JSON)** 에 넣어서 기존 책자 데이터와 **섞이지 않도록** 할 수 있습니다.

---

## 2. 제작 유형 목록(예시)

| 유형 코드 | 표시명 | 비고 |
|-----------|--------|------|
| `book` | 책자 | 현재 구현 (매체 선택 → 표지/본문 사양 참고) |
| `sheet` | 낱장 인쇄물 | 용지, 규격, 도수 등 |
| `sticker` | 스티커 | 규격, 재질, 수량 등 |
| `banner` | 배너 | 크기, 거치대 유무 등 |
| `etc` | 기타 | 패키지, 상자, 봉투 등 (공통 필드 + 비고) |

유형은 **코드/설정 한 곳**에서만 관리하면, 나중에 항목 추가·수정이 쉽습니다.

---

## 3. 기존 데이터와 엉키지 않게 하는 원칙

- **공통 필드**는 그대로 두고, **유형만 구분**하는 컬럼을 하나 추가합니다.
- **유형별로 다른 항목**은 **한 컬럼에 JSON**으로 저장해, 유형이 바뀌어도 다른 유형 데이터를 덮어쓰지 않게 합니다.
- **책자**는 지금처럼 `media_id`, `media_name`, `spec_snapshot`을 계속 사용하고, **다른 유형**은 `media_id`는 비우거나 고정값, 상세는 JSON에만 넣습니다.

이렇게 하면:

- 기존 책자 의뢰: 로직·컬럼 유지, `order_type=책자`만 넣어 주면 됨.
- 새 유형: `order_type` + `type_spec_snapshot`(JSON) 만 추가해, 기존 컬럼 의미는 그대로 유지.

---

## 4. 데이터 구조 제안

### 4.1 시트(jobs_raw) 컬럼 추가

| 추가 컬럼 | 타입 | 용도 |
|-----------|------|------|
| `order_type` | 문자열 | `book` \| `sheet` \| `sticker` \| `banner` \| `etc`. 기존 행은 비우거나 `book` 처리. |
| `type_spec_snapshot` | 문자열(JSON) | 유형별 입력값만 저장. 책자는 비워 두고 기존 `spec_snapshot` 사용. |

- **기존 컬럼**: `job_id`, `created_at`, `requester_name`, `media_id`, `media_name`, `vendor`, `due_date`, `qty`, `file_link`, `changes_note`, `status`, `spec_snapshot`, `last_updated_at`, `last_updated_by` 는 유지.
- **책자(book)**  
  - `order_type = "book"`  
  - `media_id`, `media_name`, `spec_snapshot` 사용 (지금과 동일)  
  - `type_spec_snapshot` 은 비우거나 `{}`
- **그 외 유형**  
  - `order_type = "sheet"` 등  
  - `media_id` / `media_name` 은 `""` 또는 `"-"`  
  - `spec_snapshot` 은 `""` 또는 `{}`  
  - 상세 내용은 전부 `type_spec_snapshot` 에만 저장  

예시 (낱장):

```json
// type_spec_snapshot (낱장)
{
  "paper": "아트지 200g",
  "size": "210×297",
  "color": "4도",
  "qty_detail": "500장"
}
```

예시 (배너):

```json
// type_spec_snapshot (배너)
{
  "size": "900×2000",
  "stand": "거치대 있음",
  "material": "현수막"
}
```

이렇게 하면 **유형별로 키가 달라도** 한 컬럼에만 저장되므로, 새 유형을 추가해도 기존 유형 데이터와 엉키지 않습니다.

---

## 5. 유형 정의·스키마 관리 (추가 항목 대비)

유형을 **나중에 추가**할 수 있게, “유형 목록”과 “유형별 입력 항목”을 **한 곳**에서 관리하는 편이 좋습니다.

### 방식 A: 코드로 유형/스키마 정의 (권장)

- **상수/설정 파일**에 유형 목록 + 유형별 필드 정의.
- 예: `ORDER_TYPES = [{ id: 'book', label: '책자', form: 'media' }, { id: 'sheet', label: '낱장 인쇄물', fields: [...] }, ...]`
- 새 유형 추가 시: 이 목록에 항목 하나 + 폼 필드 정의만 추가. 시트 구조는 이미 `order_type` + `type_spec_snapshot` 으로 확장돼 있으므로 **기존 값과 엉키지 않음**.

### 방식 B: 시트로 유형 목록만 관리

- 예: `order_types` 시트 (id, label, sort).
- “입력 항목 정의”는 코드에 두고, 유형 id만 시트에서 가져와서 사용.
- 새 유형 추가: 시트에 한 행 추가 + 코드에 해당 유형 폼 필드만 추가.

둘 다 “추가 항목이 기존 값과 엉키지 않도록” 하려면, **유형별 payload는 반드시 `type_spec_snapshot` 한 컬럼에만** 넣는 전제가 같습니다.

---

## 6. 화면·플로우 제안

### 6.1 새 의뢰 작성 페이지

1. **1단계: 제작 유형 선택**  
   - 라디오 또는 셀렉트: 책자 / 낱장 인쇄물 / 스티커 / 배너 / 기타.
2. **2단계: 유형별 입력**
   - **책자**: 현재와 동일 (매체 선택 → 자동 사양 표시) + 공통 필드(의뢰자, 출력실, 납기, 수량, 파일링크, 변경사항).
   - **낱장**: 용지, 규격, 도수, 수량 등 유형별 필드 + 공통 필드.
   - **스티커 / 배너 / 기타**: 각각 정의한 필드 + 공통 필드.
3. **제출**  
   - 공통 필드는 기존처럼 job 컬럼에 매핑.  
   - 유형별 값은 `order_type` + `type_spec_snapshot`(JSON) 으로만 저장.

### 6.2 목록·상세

- 목록: `order_type` 컬럼으로 “제작 유형” 컬럼 추가 가능. 필터도 유형별로 가능.
- 상세: `order_type`이 책자면 지금처럼 `spec_snapshot` 기준 표시, 그 외는 `type_spec_snapshot` 파싱해서 유형별 레이아웃으로 표시.

이렇게 하면 **선택한 유형에 따라 입력 항목만 바꾸고**, 저장 구조는 통일할 수 있습니다.

---

## 7. 구현 시 할 일 요약

| 순서 | 내용 |
|------|------|
| 1 | 시트에 `order_type`, `type_spec_snapshot` 컬럼 추가. 기존 행은 `order_type` 비우거나 `book` 처리. |
| 2 | 코드에 `JobRow` 확장, `appendJob`/`getJobs`/`getJobById` 등에서 두 필드 읽기·쓰기. |
| 3 | 유형 상수/스키마 정의 (ORDER_TYPES + 유형별 필드 목록). |
| 4 | 새 의뢰 폼: 1) 제작 유형 선택 UI, 2) 유형별 폼 분기 (책자 = 현재 폼, 나머지 = 유형별 필드). |
| 5 | POST /api/jobs: `order_type` 수신, 책자면 기존 로직, 그 외는 `type_spec_snapshot`만 채워서 저장. |
| 6 | 목록/상세에서 `order_type` 표시 및 `type_spec_snapshot` 표시 로직. |

---

## 8. 정리

- **구현 가능 여부**: 가능합니다.
- **유형 선택 후 유형별 입력 적용**: 1단계 유형 선택 → 2단계 유형별 폼으로 구현 가능합니다.
- **나중에 유형 추가**: 유형 목록 + 해당 유형의 “입력 필드 정의”만 추가하면 되고, **저장은 항상 `order_type` + `type_spec_snapshot`** 이므로 기존 데이터와 섞이지 않습니다.
- **권장**: 유형·스키마는 코드(상수/설정)로 관리 + 시트는 `order_type` / `type_spec_snapshot` 두 컬럼만 확장.

이 방향으로 진행하시면, 이후 “알림(Make 웹훅 + 출력업체/관리자)” 도 동일한 job 데이터를 기준으로 붙이기 쉽습니다.
